{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MidWayHelper</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'sans-serif'],
          },
        },
      },
    };
    if (localStorage.getItem("theme") === "dark") {
      document.documentElement.classList.add("dark");
    }
  </script>
  <style>
    .btn-hover { transition: background-color 0.3s ease, border-color 0.3s ease; }
    .btn-hover:hover { background-color: #e5e7eb; border-color: #3b82f6; }
    .dark .btn-hover:hover { background-color: #1f2937; border-color: #60a5fa; }
    .full-overlay-img { width: 100%; height: 100%; object-fit: cover; }
  </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100 font-sans transition duration-300 ease-in-out">
<header class="w-full p-4 flex justify-between items-center border-b border-gray-200 dark:border-gray-700 shadow-md">
  <div class="flex items-center gap-2 z-10">
    <span class="text-lg">‚òÄÔ∏è</span>
    <label class="relative inline-flex items-center cursor-pointer">
      <input type="checkbox" id="themeToggle" class="sr-only peer" onchange="toggleTheme()" />
      <div class="w-11 h-6 bg-gray-300 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full after:absolute after:top-[2px] after:left-[2px] after:bg-white after:h-5 after:w-5 after:transition-all"></div>
    </label>
    <span class="text-lg">üåô</span>
  </div>
  <h1 class="absolute left-1/2 transform -translate-x-1/2 text-3xl font-extrabold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-500 bg-clip-text text-transparent">MidWayHelper</h1>
  <nav class="flex items-center gap-4 text-sm z-10">
    <a href="#" class="hover:text-blue-500 transition">History</a>
    <a href="#" class="hover:text-blue-500 transition">Notifications</a>
    <a href="#" class="hover:text-blue-500 transition">Support</a>
    <a href="{% url 'bookings' %}" class="hover:text-blue-500 transition">Bookings</a>
    <a href="#" class="hover:text-blue-500 transition">Profile</a>
  </nav>
</header>
<main class="flex flex-col md:flex-row h-[calc(100vh-64px)] w-full">
  <div class="relative md:w-1/2 h-1/2 md:h-full bg-cover bg-center" style="background-image: url('https://via.placeholder.com/800x600?text=Create+Ride');">
    <div id="leftOverlay" class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 transition-opacity">
      <img src="{% static 'images/image.png' %}" class="full-overlay-img" />
    </div>
    <a href="{% url 'createride' %}" onmouseenter="toggleOverlay('leftOverlay', true)" onmouseleave="toggleOverlay('leftOverlay', false)" class="absolute z-10 left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 px-8 py-4 bg-white dark:bg-gray-800 text-black dark:text-white border border-transparent hover:border-blue-500 rounded-xl font-semibold shadow-lg btn-hover text-lg">Create Ride</a>
  </div>
  <div class="relative md:w-1/2 h-1/2 md:h-full bg-cover bg-center" style="background-image: url('https://via.placeholder.com/800x600?text=Search+Rides');">
    <div id="rightOverlay" class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center opacity-0 transition-opacity">
      <img src="{% static 'images/lift.png' %}" class="full-overlay-img" />
    </div>
    <a href="{% url 'searchride' %}" onmouseenter="toggleOverlay('rightOverlay', true)" onmouseleave="toggleOverlay('rightOverlay', false)" class="absolute z-10 left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 px-8 py-4 bg-white dark:bg-gray-800 text-black dark:text-white border border-transparent hover:border-blue-500 rounded-xl font-semibold shadow-lg btn-hover text-lg">Search for Rides</a>
  </div>
</main>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const isDark = localStorage.getItem("theme") === "dark" || (!localStorage.getItem("theme") && window.matchMedia('(prefers-color-scheme: dark)').matches);
    document.getElementById('themeToggle').checked = isDark;
    if (isDark) {
      document.documentElement.classList.add("dark");
    }
  });
  function toggleTheme() {
    const isDark = document.documentElement.classList.toggle('dark');
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }
  function toggleOverlay(id, show) {
    const el = document.getElementById(id);
    el.style.opacity = show ? '1' : '0';
  }
</script>

<!-- üöÄ DRIVER LOCATION SCRIPT -->
<script>
  const userType = "{{ user_type }}";
  const rideId = "{{ ride_id }}";

  if (userType === "driver") {
    const socket = new WebSocket(`wss://c6f8-2409-4091-800d-2c04-14f1-9a66-d92-2186.ngrok-free.app/ws/track/${rideId}/`);

    socket.onopen = () => {
      console.log("‚úÖ WebSocket connected");

      let lastSentLat = null, lastSentLng = null;

      function sendLocation() {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const lat = pos.coords.latitude;
            const lng = pos.coords.longitude;

            // Only send if location changed
            if (lat !== lastSentLat || lng !== lastSentLng) {
              socket.send(JSON.stringify({ lat, lng }));
              lastSentLat = lat;
              lastSentLng = lng;
            }
          },
          (err) => console.error("üìç GPS Error:", err.message),
          { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
      }

      sendLocation(); // Initial send
      setInterval(sendLocation, 3000); // Send every 3 seconds
    };

    socket.onerror = (err) => console.error("‚ùå WebSocket Error", err);
    socket.onclose = () => console.warn("‚ö†Ô∏è WebSocket Closed");
  }
</script>
</body>
</html>
